<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª–µ—Ç–∞ –¥—Ä–æ–Ω–∞-–∫–≤–∞–¥—Ä–∞–∫–æ–ø—Ç–µ—Ä–∞</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÅ –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª–µ—Ç–∞ –¥—Ä–æ–Ω–∞-–∫–≤–∞–¥—Ä–∞–∫–æ–ø—Ç–µ—Ä–∞</h1>
            <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è 3D —Å–∏–º—É–ª—è—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π –õ—è–ø—É–Ω–æ–≤–∞</p>
        </header>

        <div class="main-layout">
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <aside class="control-panel">
                <div class="panel-section">
                    <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–µ–π</h2>
                    <div class="button-group">
                        <button id="startBtn" class="btn btn-primary">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
                        <button id="pauseBtn" class="btn btn-secondary" disabled>‚è∏ –ü–∞—É–∑–∞</button>
                        <button id="stopBtn" class="btn btn-danger" disabled>‚èπ –°—Ç–æ–ø</button>
                        <button id="resetBtn" class="btn btn-warning">üîÑ –°–±—Ä–æ—Å</button>
                    </div>

                    <div class="keyboard-control-section">
                        <div id="keyboardIndicator" class="keyboard-indicator">ü§ñ –ê–í–¢–û–ü–ò–õ–û–¢</div>
                        <div class="keyboard-hint">
                            <strong>–ù–∞–∂–º–∏—Ç–µ K</strong> –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è<br>
                            <small>WASD - –¥–≤–∏–∂–µ–Ω–∏–µ, Space/Shift - –≤—ã—Å–æ—Ç–∞</small>
                        </div>
                    </div>

                    <div class="demo-section">
                        <button id="demoBtn" class="btn btn-demo">üéØ –î–ï–ú–û-–†–ï–ñ–ò–ú –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–ò</button>
                        <p class="demo-hint">
                            <strong>–¶–µ–ª—å:</strong> –£–¥–µ—Ä–∂–∞—Ç—å –¥—Ä–æ–Ω –≤ —Ç–æ—á–∫–µ (0, 2, 0)<br>
                            <strong>–í–æ–∑–¥–µ–π—Å—Ç–≤–∏—è:</strong> –í–µ—Ç–µ—Ä + —Ç–æ–ª—á–∫–∏ –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ
                        </p>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üéì –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è</h2>
                    <p class="training-description">
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ PID –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
                    </p>
                    <div class="training-controls">
                        <button id="startTrainingBtn" class="btn btn-training">üéì –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
                        <button id="stopTrainingBtn" class="btn btn-secondary" disabled>‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                    <div id="trainingProgress" class="training-progress" style="display: none;">
                        <div class="progress-info">
                            <span id="trainingStatus">–ì–æ—Ç–æ–≤–æ</span>
                            <span id="trainingIteration">0 / 50</span>
                        </div>
                        <div class="progress-bar-container">
                            <div id="trainingProgressBar" class="progress-bar"></div>
                        </div>
                        <div class="training-stats">
                            <div class="stat-item">
                                <span class="stat-label">–õ—É—á—à–∏–π Score:</span>
                                <span id="trainingScore" class="stat-value">-</span>
                            </div>
                        </div>
                    </div>
                    <div id="trainingResults" class="training-results" style="display: none;"></div>
                    <div class="training-actions" style="display: none;" id="trainingActions">
                        <button id="applyBestBtn" class="btn btn-success">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª—É—á—à–∏–µ</button>
                        <button id="restoreOriginalBtn" class="btn btn-warning">üîô –í–µ—Ä–Ω—É—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üëÅÔ∏è –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</h2>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="showTarget" checked>
                            –ü–æ–∫–∞–∑–∞—Ç—å —Ü–µ–ª–µ–≤—É—é —Ç–æ—á–∫—É
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="showForces" checked>
                            –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã —Å–∏–ª
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="showTrajectory" checked>
                            –ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é
                        </label>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥—Ä–æ–Ω–∞</h2>
                    <div class="input-group">
                        <label for="mass">–ú–∞—Å—Å–∞ (–∫–≥):</label>
                        <input type="number" id="mass" value="1.0" min="0.1" max="10" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="motorThrust">–¢—è–≥–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ù):</label>
                        <input type="number" id="motorThrust" value="2.5" min="1" max="20" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="motorDistance">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤–∏–≥–∞—Ç–µ–ª—è–º–∏ (–º):</label>
                        <input type="number" id="motorDistance" value="0.25" min="0.1" max="1" step="0.05">
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üå™Ô∏è –í–Ω–µ—à–Ω–∏–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="input-group">
                        <label for="windSpeed">–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ (–º/—Å):</label>
                        <input type="number" id="windSpeed" value="0" min="0" max="20" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="windDirection">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞ (¬∞):</label>
                        <input type="number" id="windDirection" value="0" min="0" max="360" step="15">
                    </div>
                    <div class="input-group">
                        <label for="impulseFrequency">–ß–∞—Å—Ç–æ—Ç–∞ —Ç–æ–ª—á–∫–æ–≤ (—Ä–∞–∑/—Å–µ–∫):</label>
                        <input type="number" id="impulseFrequency" value="0.5" min="0" max="5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="impulseIntensity">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ç–æ–ª—á–∫–æ–≤ (–ù):</label>
                        <input type="number" id="impulseIntensity" value="5" min="0" max="50" step="1">
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="enableObstacles">
                            –í–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                        </label>
                    </div>

                    <h3 style="margin-top: 15px; margin-bottom: 10px; color: #88ff44;">ü•í –ë–∞–Ω–∫–∏ —Å –æ–≥—É—Ä—Ü–∞–º–∏</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="enablePickleJars">
                            –í–∫–ª—é—á–∏—Ç—å –ª–µ—Ç–∞—é—â–∏–µ –±–∞–Ω–∫–∏
                        </label>
                    </div>
                    <div class="input-group">
                        <label for="pickleJarFrequency">–ß–∞—Å—Ç–æ—Ç–∞ –±–∞–Ω–æ–∫ (—Ä–∞–∑/—Å–µ–∫):</label>
                        <input type="number" id="pickleJarFrequency" value="0.3" min="0" max="2" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="pickleJarSpeed">–°–∫–æ—Ä–æ—Å—Ç—å –±–∞–Ω–æ–∫ (–º/—Å):</label>
                        <input type="number" id="pickleJarSpeed" value="3.0" min="1" max="10" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="pickleJarImpactForce">–°–∏–ª–∞ —É–¥–∞—Ä–∞ (–ù):</label>
                        <input type="number" id="pickleJarImpactForce" value="10" min="5" max="50" step="1">
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üéØ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</h2>
                    <div class="input-group">
                        <label for="kpPos">kp (–ø–æ–∑–∏—Ü–∏—è):</label>
                        <input type="number" id="kpPos" value="10.0" min="0" max="50" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="kdPos">kd (–ø–æ–∑–∏—Ü–∏—è):</label>
                        <input type="number" id="kdPos" value="5.0" min="0" max="20" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="kiPos">ki (–ø–æ–∑–∏—Ü–∏—è):</label>
                        <input type="number" id="kiPos" value="0.1" min="0" max="5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="kpRot">kp (–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è):</label>
                        <input type="number" id="kpRot" value="8.0" min="0" max="50" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="kdRot">kd (–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è):</label>
                        <input type="number" id="kdRot" value="4.0" min="0" max="20" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="kiRot">ki (–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è):</label>
                        <input type="number" id="kiRot" value="0.05" min="0" max="5" step="0.05">
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                    <div class="info-display">
                        <div class="info-item">
                            <span class="info-label">–ü–æ–∑–∏—Ü–∏—è (x, y, z):</span>
                            <span class="info-value" id="positionInfo">0.00, 0.00, 0.00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–°–∫–æ—Ä–æ—Å—Ç—å (–º/—Å):</span>
                            <span class="info-value" id="velocityInfo">0.00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è (¬∞):</span>
                            <span class="info-value" id="rotationInfo">0, 0, 0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–§—É–Ω–∫—Ü–∏—è –õ—è–ø—É–Ω–æ–≤–∞:</span>
                            <span class="info-value" id="lyapunovInfo">0.00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">FPS:</span>
                            <span class="info-value" id="fpsInfo">60</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 3D –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è -->
            <main class="visualization-container">
                <div id="canvas-container"></div>

                <!-- –õ–µ–≥–µ–Ω–¥–∞ –≤–µ–∫—Ç–æ—Ä–æ–≤ —Å–∏–ª -->
                <div class="forces-legend" id="forcesLegend">
                    <h4>–õ–µ–≥–µ–Ω–¥–∞ –≤–µ–∫—Ç–æ—Ä–æ–≤ —Å–∏–ª:</h4>
                    <div class="legend-item">
                        <span class="legend-arrow" style="background: #00bfff;"></span>
                        <span>–í–µ—Ç–µ—Ä</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-arrow" style="background: #ff8c00;"></span>
                        <span>–ò–º–ø—É–ª—å—Å—ã</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-arrow" style="background: #ff0000;"></span>
                        <span>–°—É–º–º–∞—Ä–Ω–∞—è –≤–Ω–µ—à–Ω—è—è —Å–∏–ª–∞</span>
                    </div>
                </div>

                <div class="camera-controls-hint">
                    üí° –ö–∞–º–µ—Ä–∞: –õ–ö–ú - –≤—Ä–∞—â–µ–Ω–∏–µ, –ö–æ–ª–µ—Å–∏–∫–æ - –∑—É–º, –ü–ö–ú - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ |
                    ‚å®Ô∏è –ù–∞–∂–º–∏—Ç–µ K –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
                    üéØ "–î–ï–ú–û-–†–ï–ñ–ò–ú" –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
                </div>
            </main>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Three.js –∏–∑ CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞ -->
    <script type="module" src="js/drone.js"></script>
    <script type="module" src="js/lyapunov.js"></script>
    <script type="module" src="js/externalForces.js"></script>
    <script type="module" src="js/keyboardControl.js"></script>
    <script type="module" src="js/trainingMode.js"></script>
    <script type="module" src="js/visualization.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/simulation.js"></script>

    <!-- –û—Ç–ª–∞–¥–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–µ–º–æ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏) -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
        setTimeout(() => {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:');
            console.log('- –ö–Ω–æ–ø–∫–∞ demoBtn:', document.getElementById('demoBtn') ? '‚úÖ' : '‚ùå');
            console.log('- window.simulation:', window.simulation ? '‚úÖ' : '‚ùå');

            if (window.simulation && window.simulation.startDemoMode) {
                console.log('- –ú–µ—Ç–æ–¥ startDemoMode:', '‚úÖ');
            } else {
                console.error('‚ùå –ú–µ—Ç–æ–¥ startDemoMode –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            }

            // –ï—Å–ª–∏ –≤—Å–µ –µ—Å—Ç—å, –Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ä—É—á–Ω—É—é
            const demoBtn = document.getElementById('demoBtn');
            if (demoBtn && window.simulation && !demoBtn.dataset.listenerAdded) {
                console.log('‚ö†Ô∏è –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –¥–µ–º–æ –≤—Ä—É—á–Ω—É—é...');
                demoBtn.addEventListener('click', function() {
                    console.log('üéØ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –¥–µ–º–æ (–ø—Ä—è–º–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫)');
                    if (window.simulation.isDemoMode) {
                        window.simulation.exitDemoMode();
                        this.textContent = 'üéØ –î–ï–ú–û-–†–ï–ñ–ò–ú –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–ò';
                        this.classList.remove('active-demo');
                    } else {
                        window.simulation.startDemoMode();
                        this.textContent = 'üîô –í–´–ô–¢–ò –ò–ó –î–ï–ú–û-–†–ï–ñ–ò–ú–ê';
                        this.classList.add('active-demo');
                    }
                });
                demoBtn.dataset.listenerAdded = 'true';
                console.log('‚úÖ –ü—Ä—è–º–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω');
            }
        }, 500);
    </script>
</body>
</html>

